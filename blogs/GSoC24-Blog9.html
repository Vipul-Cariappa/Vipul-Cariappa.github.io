<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="GSoC 2024 Final Report with Python Software Foundation LPython Sub-Org." />
  <meta name="author" content="Vipul Cariappa" />

  <title>GSoC'24 Final Report | Vipul Cariappa</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous" />
  <!-- Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" rel="stylesheet" />
  <!-- Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alice|Open+Sans:400,300,700" />
  <!-- Custom styles -->
  <link rel="stylesheet" href="/assets/css/styles.css" />
</head>

<body>
  <div class="min-vh-100 d-flex flex-column justify-content-between">
    <header id="header">
      <div id="head" class="parallax" parallax-speed="1">
        <h1 id="logo" class="text-center">
          <span class="title">Vipul Cariappa</span>
          <span class="tagline">Enthusiastic Programmer</span>
        </h1>
      </div>

      <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
          <a class="navbar-brand" href="#"></a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="/index.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/projects.html">Projects</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/blogs.html">Blog</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <main id="main">
      <div class="container">
        <div class="col-sm-12 col-sm-offset-2">
          <article class="post">
            <header class="entry-header">
              <div class="entry-meta">
                <span class="posted-on">
                  <time class="entry-date published" date="2024-08-25">
                    August 25, 2024
                  </time>
                </span>
              </div>
              <h1 class="entry-title">
                <a href="#" rel="bookmark">GSoC'24 Final Report</a>
              </h1>
            </header>
            <div class="entry-content">
              <p>This is the final report of my work done during the Google Summer of
                Code 2024 period with the Python Software Foundation, LPython
                sub-organisation.</p>
              <p>LPython is a statically typed, compiled variant of Python. It is much
                faster than CPython (the most common Python interpreter). LPython is
                able to be fast because of the static types as compared to dynamic types
                in Python and being a compiled language. Our compiler can also be used
                to trans-compiler Python code to C, C++ and Fortran code. LFortran is a
                sister project to LPython. Both use the same back-end for target code
                generation and other compiler optimisations.</p>
              <p>I implemented a REPL (read-evaluate-print-loop) shell for LPython.
                This required modification of the way we compile. I used LLVM’s JIT
                compiler to just-in-time compile the code. Work on REPL laid the
                groundwork for implementing a Jupyter Kernel. Jupyter Kernel had already
                been implemented for LFortran, and I only had to adapt it to work with
                LPython. Following that, I worked on interoperability of LPython with
                CPython. We intend to provide first class support to use CPython
                libraries within LPython.</p>
              <h2 id="detailed-description">Detailed Description</h2>
              <h3 id="read-evaluate-print-loop">Read Evaluate Print Loop</h3>
              <p>I faced a lot of issues initially. Our code base was designed for
                ahead-of-time compilation. I had to adapt it to work for just-in-time
                compilation. I was using LLVM 11 for development. But the project
                intends to support all the LLVM versions from 10. This required
                additional care for changes in LLVM’s API across versions.</p>
              <p><strong>Pull Requests</strong></p>
              <ul>
                <li><a href="https://github.com/lcompilers/lpython/pull/2617">Interactive shell
                    implementation</a><br> Initial implementation of interactive shell</li>
                <li><a href="https://github.com/lcompilers/lpython/pull/2706">Fix ASR
                    verify pass error while using Interactive</a><br> ASR verify is used to
                  check if the syntax tree generated is valid. While using the interactive
                  mode, there were cases where the syntax tree generated was valid but the
                  ASR verify pass would throw error saying it is invalid.</li>
                <li><a href="https://github.com/lcompilers/lpython/pull/2713">Initial
                    test for Interactive</a><br> Adding in the initial tests to check and
                  validate the workings of REPL.</li>
                <li>Printing top-level expressions that are evaluated on each REPL
                  execution loop
                  <ul>
                    <li><a href="https://github.com/lcompilers/lpython/pull/2716">Printing
                        top-level Expressions</a></li>
                    <li><a href="https://github.com/lcompilers/lpython/pull/2717">Support to
                        print <code>u32</code> and <code>u64</code> in REPL</a></li>
                    <li><a href="https://github.com/lcompilers/lpython/pull/2719">Support to
                        print <code>i8</code>, <code>u8</code>, <code>i16</code> and
                        <code>u16</code> in Interactive mode</a></li>
                    <li><a href="https://github.com/lcompilers/lpython/pull/2724">REPL
                        <code>str</code> support</a></li>
                    <li><a href="https://github.com/lcompilers/lpython/pull/2728">support
                        printing <code>boolean</code> in REPL</a></li>
                    <li><a href="https://github.com/lcompilers/lpython/pull/2785">Support to
                        print dataclasses and tuples in REPL</a></li>
                  </ul>
                </li>
                <li><a href="https://github.com/lcompilers/lpython/pull/2754">CI tests
                    for LLVM 10, 14, 15 and 16</a><br> I added in automated GitHub workflows
                  to compile and test LPython against multiple versions of LLVM that we
                  intend to support.</li>
                <li><a href="https://github.com/lcompilers/lpython/pull/2755">Underscore:
                    <code>_</code> variable in REPL</a><br> The underscore variable
                  <code>_</code> is used to retrieve and use the value of the previously
                  evaluated expression in REPL. LPython is statically typed, but the type
                  of evaluated expression can change in each loop. Therefore, the
                  <code>_</code> is name mangled to be something else in each REPL
                  execution loop.
                </li>
              </ul>
              <p>There are a few missing features. Error messages that are produced in
                REPL are fuzzy. Top level printing of a few aggregate datatypes are not
                yet implemented.</p>
              <h3 id="jupyter-kernel">Jupyter Kernel</h3>
              <p>A single pull request with more than 1000 lines of code changes. <a
                  href="https://github.com/lcompilers/lpython/pull/2764">Jupyter
                  Kernel</a> We are using <a href="https://xeus.readthedocs.io/en/latest/"><code>xeus</code></a>
                library to build LPython’s Jupyter Kernel. <code>xeus</code> is a C++
                library used to create Jupyter Kernels.</p>
              <h3 id="interoperability-with-cpython">Interoperability with
                CPython</h3>
              <p>LPython previously used to support using CPython libraries only when
                using the C back-end (i.e. trans-compiling LPython code to C source
                code). I have written an ASR pass, that work on the syntax tree to
                produce or generate the additional logic for type conversions between
                CPython and LPython types, and function resolution to find and call
                CPython functions from LPython. As this implementation works on the
                syntax tree directly, all the back-ends can use it out of the box
                without any additional changes specific to each back-end.</p>
              <p><strong>Pull Requests</strong></p>
              <ul>
                <li><a href="https://github.com/lcompilers/lpython/pull/2796">BindPython
                    ABI</a><br> Implemented function resolution and type conversions for
                  primitive datatypes.</li>
                <li><a href="https://github.com/lcompilers/lpython/pull/2803">BindPython
                    ASR Pass: aggregate type conversions</a><br> Implemented type
                  conversions for aggregate type such as <code>list</code>,
                  <code>tuple</code>, <code>set</code>, and <code>dict</code>.
                </li>
              </ul>
              <p>There is a small bug in this implementation. There is no error
                handling. This is required when type conversions are not possible or
                function resolution fails. Presently, it is undefined behaviour. I will
                be fixing this within a week.</p>
              <h3 id="pull-requests-related-to-bug-fixes">Pull Requests related to Bug
                Fixes</h3>
              <ul>
                <li><a href="https://github.com/lcompilers/lpython/pull/2626">Prevent
                    calling <code>abort</code> while handling the <code>SIGABRT</code>
                    signal</a></li>
                <li><a href="https://github.com/lcompilers/lpython/pull/2696">Combine
                    <code>global_init</code> and <code>global_stmts</code> functions into
                    <code>global_stmts</code></a> This fixed a bug in which variables would
                  be initialised wrongly if it depended on other variable.</li>
                <li><a href="https://github.com/lcompilers/lpython/pull/2701">avoiding
                    name mangling while interactive is true</a><br> This was required to get
                  the function symbols while using the REPL shell.</li>
                <li><a href="https://github.com/lcompilers/lpython/pull/2704">removing
                    _lfortran_caimag and _lfortran_zaimag functions</a><br> We had
                  declarations for some functions that did not have any definition.</li>
                <li>Symbol duplication bugs while using REPL: Variable of specific
                  datatype would be redefined in each REPL loop.
                  <ul>
                    <li><a href="https://github.com/lcompilers/lpython/pull/2707">Fixes
                        complex datatype’s symbol duplication bug while using
                        interactive</a></li>
                    <li><a href="https://github.com/lcompilers/lpython/pull/2734">fix array
                        symbol duplication in interactive mode</a></li>
                  </ul>
                </li>
                <li><a href="https://github.com/lcompilers/lpython/pull/2727">combining
                    duplicated function into a single templated function</a><br> To reduce
                  code duplication and improve code readability and debugability.</li>
              </ul>
              <h3 id="pull-requests-that-were-not-merged">Pull requests that were not
                merged</h3>
              <ul>
                <li><a href="https://github.com/lfortran/lfortran/pull/4391">Support to
                    redefine of function in REPL</a><br> Implementation of function
                  redefinition is tricky with compiled languages. There are many questions
                  regarding the implementation details; Should the previous definition of
                  the function be kept in memory or deallocated? What if, there is a
                  pointer to the old definition? Should it be updated? If <code>g</code>
                  calls <code>f</code>, and we redefine <code>f</code>, should
                  <code>g</code> now be calling the new definition of <code>f</code> or
                  the old definition of <code>f</code>? I implemented according to what
                  felt correct to me. But then when we compared it to the behaviour of
                  CPython, it was decided to hold off further work. You can find the
                  detailed explanation in <a href="https://www.vipulcariappa.xyz/blogs/GSoC24-Blog4.html">this
                    blog</a>.
                </li>
              </ul>
              <h3 id="issues-opened">Issues Opened</h3>
              <ul>
                <li><a href="https://github.com/lcompilers/lpython/issues/2793">Segfault
                    while printing <code>dataclass</code> in REPL</a><br> LPython
                  experiences a segmentation fault and crashes when trying to print a
                  specific type of <code>dataclass</code> in REPL. I suspect that the
                  issue is at the LLVM’s code, and not our code base.</li>
                <li><a href="https://github.com/lcompilers/lpython/issues/2792">GitHub
                    Workflow Fails with LLVM 14</a></li>
                <li><a href="https://github.com/lcompilers/lpython/issues/2725">Blank
                    line within an indented block of code is wrongly parsed on
                    Windows</a><br> Windows uses <code>\r\n</code> to represent end of a
                  line. Whereas other operating systems use <code>\n</code>. Due to this
                  difference between the end of line representation, the parse ends up
                  parsing the source code incorrectly.</li>
              </ul>
              <h2 id="acknowledgement">Acknowledgement</h2>
              <p>I would like to thank Google Summer of Code for providing this
                opportunity, and my mentors <a href="https://github.com/Shaikh-Ubaid">Ubaid Shaikh</a> and <a
                  href="https://github.com/certik">Ondřej Čertík</a> for there guidance
                and help throughout the project.</p>

            </div>
          </article>
        </div>
      </div>
    </main>

    <footer id="underfooter">
      <div class="container">
        <div class="row justify-content-between">
          <div class="col-4">
            <p class="follow-me-icons">
              <a href="https://github.com/Vipul-Cariappa"><i class="fa-brands fa-github"></i></a>
              <a href="https://medium.com/@vipulcariappa"><i class="fa-brands fa-medium"></i></a>
              <a href="https://stackoverflow.com/users/14512079/vipul-cariappa"><i
                  class="fa-brands fa-stack-overflow"></i></a>
            </p>
          </div>

          <div class="col-4">
            <p class="test-end">
              Vipul Cariappa<br />
              Design By:
              <a href="https://pozhilov.com" rel="designer">Sergey Pozhilov</a>
            </p>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <!-- JavaScript libs are placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
    crossorigin="anonymous"></script>
</body>

</html>